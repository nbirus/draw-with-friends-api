{"id":"services/game.js","dependencies":[{"name":"/Users/birusnt/Development/draw-with-friends-api/package.json","includedInParent":true,"mtime":1598979062184},{"name":"../socket.js","loc":{"line":1,"column":19},"parent":"/Users/birusnt/Development/draw-with-friends-api/services/game.js","resolved":"/Users/birusnt/Development/draw-with-friends-api/socket.js"},{"name":"./global","loc":{"line":3,"column":23},"parent":"/Users/birusnt/Development/draw-with-friends-api/services/game.js","resolved":"/Users/birusnt/Development/draw-with-friends-api/services/global.js"}],"generated":{"js":"const io = require('../socket.js').getio();\n\nconst _ = require('lodash');\n\nconst global = require('./global');\n\nconst LOG = true; // socket events\n\nio.on('connection', socket => {\n  socket.on('mousemove', mouseMove);\n  socket.on('guess', guess);\n}); // actions\n\nfunction startGame(room) {\n  log('start', room.roomid);\n  room.game = room.game(room, () => endGame(room));\n  brodcastStartGame(room);\n}\n\nfunction endGame(room) {\n  log('end', room.roomid);\n} // event handlers\n\n\nfunction mouseMove(data) {\n  let room = global.rooms[data.roomid];\n\n  if (room !== undefined) {\n    for (const client of room.sockets) {\n      client.emit('moving', data);\n    }\n  }\n}\n\nfunction guess(data) {\n  log('guess', data.roomid, data.userid);\n  let room = global.rooms[data.roomid];\n\n  if (room !== undefined) {\n    // set guesses on room object\n    room.guesses.push({\n      userid: data.userid,\n      username: data.username,\n      guess: data.guess\n    }); // send guess to game obj\n\n    room.game.guess(data, doesMatch => {\n      room.users[socket.userid].match = doesMatch;\n\n      if (doesMatch) {\n        room.users[socket.userid].score++;\n      }\n    });\n    brodcastRoomUpdate(room);\n  }\n} // brodcasts\n\n\nfunction brodcastStartGame(room) {\n  for (const client of room.sockets) {\n    client.emit('room_ready');\n  }\n} // helpers\n\n\nfunction log(message, roomid, userid) {\n  if (LOG) {\n    if (userid) {\n      console.log(`game:${message}`, roomid, userid);\n    } else {\n      console.log(`game:${message}`, roomid);\n    }\n  }\n}\n\nmodule.exports = {\n  startGame\n};"},"sourceMaps":null,"error":null,"hash":"54a0c4e236dcd117954add2f7eea6ac3","cacheData":{"env":{}}}